establish_protectorate = {
	category = influence
	
	alert_index = 4
	alert_tooltip = establish_protectorate_alert_tooltip
	
	require_acceptance = yes
	
	is_visible = {
		can_be_overlord = protectorate
		FROM = {
			is_subject = no
			NOT = { technology_group = western }
			NOT = { technology_group = eastern }
			NOT = { technology_group = roman_group }
			NOT = { technology_group = muslim }
			PREV = {
				NOT = { same_continent = PREV }
			}
			is_nomad = no
			OR = {
				PREV = { institution_difference = { who = PREV value = 3 } }
				# THIS is at least 9 techs behind PREV
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_adm_tech_level
						value = trigger_value:adm_tech
					}
					export_to_variable = {
						which = our_dip_tech_level
						value = trigger_value:dip_tech
					}
					export_to_variable = {
						which = our_mil_tech_level
						value = trigger_value:mil_tech
					}
					export_to_variable = {
						which = their_adm_tech_level
						value = trigger_value:adm_tech
						who = PREV
					}
					export_to_variable = {
						which = their_dip_tech_level
						value = trigger_value:dip_tech
						who = PREV
					}
					export_to_variable = {
						which = their_mil_tech_level
						value = trigger_value:mil_tech
						who = PREV
					}
					export_to_variable = {
						which = our_total_tech_level
						value = 0
					}
					export_to_variable = {
						which = their_total_tech_level
						value = 0
					}
					variable_arithmetic_trigger = {
						change_variable = { which = our_total_tech_level which = our_adm_tech_level }
					}
					variable_arithmetic_trigger = {
						change_variable = { which = our_total_tech_level which = our_dip_tech_level }
					}
					variable_arithmetic_trigger = {
						change_variable = { which = our_total_tech_level which = our_mil_tech_level }
					}
					variable_arithmetic_trigger = {
						change_variable = { which = their_total_tech_level which = their_adm_tech_level }
					}
					variable_arithmetic_trigger = {
						change_variable = { which = their_total_tech_level which = their_dip_tech_level }
					}
					variable_arithmetic_trigger = {
						change_variable = { which = their_total_tech_level which = their_mil_tech_level }
					}
					variable_arithmetic_trigger = {
						change_variable = { which = their_total_tech_level value = -9 }
					}
					
					check_variable = { which = their_total_tech_level which = our_total_tech_level }
				}
			}
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = {
			capital_scope = { trade_range = ROOT }
		}
	}
	on_accept = {
		create_subject = {
			subject = FROM
			subject_type = protectorate
		}
		if = {
			limit = {
				any_country = {
					is_subject_of = FROM
					is_colonial_nation = no
				}
			}
			every_country = {
				limit = {
					is_subject_of = FROM
					is_colonial_nation = no
				}
				FROM = {
					PREV = { grant_independence = yes }
				}
			}
		}
	}
	on_decline = {
		FROM = {
			add_country_modifier = {
				name = declined_establish_protectorate
				duration = 1825
				hidden = yes
			}
		}
		add_opinion = {
			who = FROM
			modifier = declined_establish_protectorate
		}
	}
	ai_acceptance = {
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					NOT = { has_opinion = { who = ROOT value = 0 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					NOT = { has_opinion = { who = ROOT value = 100 } }
					has_opinion = { who = ROOT value = 0 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
			export_to_variable = {
				variable_name = ai_value_2
				value = opinion
				who = FROM
				with = THIS
			}
			divide_variable = { which = ai_value_2 value = 4 }
			change_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					has_opinion = { who = ROOT value = 100 }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = THIS
			}
			divide_variable = { which = ai_value value = 8 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OUR_DIPLOMATIC_REPUTATION
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 1 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 2 } }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 2 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 3 } }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 3 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 4 } }
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 4 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 5 } }
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 5 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 6 } }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 6 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 7 } }
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 7 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 8 } }
			}
			export_to_variable = {
				which = ai_value
				value = 70
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 8 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 9 } }
			}
			export_to_variable = {
				which = ai_value
				value = 80
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 9 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 10 } }
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 10 }
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_TOTAL_DEVELOPMENT_OVER_200
			limit = {
				FROM = { total_development = 200 }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				any_country = {
					is_subject_of = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = THIS
			}
			multiply_variable = { which = ai_value value = -0.5 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = trigger_value:mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = trigger_value:mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = ai_value
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					variable_arithmetic_trigger = {
						change_variable = { which = our_mil_tech which = their_mil_tech }
					}
					multiply_variable = { which = our_mil_tech value = 3 }
					variable_arithmetic_trigger = {
						change_variable = { which = ai_value which = our_army_size }
					}
					variable_arithmetic_trigger =  {
						change_variable = { which = ai_value which = our_mil_tech }
					}
					
					NOT = { check_variable = { which = ai_value value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = trigger_value:mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = trigger_value:mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = ai_value
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					variable_arithmetic_trigger = {
						change_variable = { which = our_mil_tech which = their_mil_tech }
					}
					multiply_variable = { which = our_mil_tech value = 3 }
					variable_arithmetic_trigger = {
						change_variable = { which = ai_value which = our_army_size }
					}
					variable_arithmetic_trigger =  {
						change_variable = { which = ai_value which = our_mil_tech }
					}
					
					check_variable = { which = ai_value value = -39 }
					NOT = { check_variable = { which = ai_value value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = trigger_value:mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = trigger_value:mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = trigger_value:mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = trigger_value:mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = ai_value
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					variable_arithmetic_trigger = {
						change_variable = { which = our_mil_tech which = their_mil_tech }
					}
					multiply_variable = { which = our_mil_tech value = 3 }
					variable_arithmetic_trigger = {
						change_variable = { which = ai_value which = our_army_size }
					}
					variable_arithmetic_trigger =  {
						change_variable = { which = ai_value which = our_mil_tech }
					}
					
					check_variable = { which = ai_value value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = ai_value
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = ai_value which = our_total_development }
					change_variable = { which = ai_value value = -90 }
					
					check_variable = { which = ai_value value = -89 }
					NOT = { check_variable = { which = ai_value value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = ai_value
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = ai_value which = our_total_development }
					change_variable = { which = ai_value value = -90 }
					
					NOT = { check_variable = { which = ai_value value = -89 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = ai_value
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = ai_value which = our_total_development }
					change_variable = { which = ai_value value = -90 }
					
					check_variable = { which = ai_value value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
	}
	ai_will_do = {
		FROM = {
			total_development = 70
			NOT = { total_development = 200 }
			NOT = { has_country_modifier = declined_establish_protectorate }
			NOT = { adm_tech = ROOT }
			NOT = { dip_tech = ROOT }
			NOT = { mil_tech = ROOT }
		}
		institution_difference = { who = FROM value = 1 }
		has_opinion = { who = FROM value = 50 }
		OR = {
			ai_attitude = { who = FROM attitude = attitude_friendly }
			ai_attitude = { who = FROM attitude = attitude_allied }
			ai_attitude = { who = FROM attitude = attitude_neutral }
		}
		OR = {
			NOT = { has_casus_belli_against = FROM }
			FROM = {
				NOT = {
					num_of_owned_provinces_with = {
						value = 3
						OR = {
							is_claim = ROOT
							is_core = ROOT
							any_country = {
								is_subject_of = ROOT
								PREV = { is_claim = PREV }
							}
							any_country = {
								is_subject_of = ROOT
								PREV = { is_core = PREV }
							}
						}
					}
				}
			}
		}
	}
}

ask_to_become_protectorate = {
	category = influence
	
	alert_index = 4
	alert_tooltip = ask_to_become_protectorate_alert_tooltip
	
	require_acceptance = yes
	
	is_visible = {
		FROM = { can_be_overlord = protectorate }
		FROM = {
			ROOT = {
				is_subject = no
				NOT = { technology_group = western }
				NOT = { technology_group = eastern }
				NOT = { technology_group = roman_group }
				NOT = { technology_group = muslim }
				PREV = {
					NOT = { same_continent = PREV }
				}
				is_nomad = no
				OR = {
					PREV = { institution_difference = { who = PREV value = 3 } }
					# THIS is at least 9 techs behind PREV
					variable_arithmetic_trigger = {
						export_to_variable = {
							which = our_adm_tech_level
							value = trigger_value:adm_tech
						}
						export_to_variable = {
							which = our_dip_tech_level
							value = trigger_value:dip_tech
						}
						export_to_variable = {
							which = our_mil_tech_level
							value = trigger_value:mil_tech
						}
						export_to_variable = {
							which = their_adm_tech_level
							value = trigger_value:adm_tech
							who = PREV
						}
						export_to_variable = {
							which = their_dip_tech_level
							value = trigger_value:dip_tech
							who = PREV
						}
						export_to_variable = {
							which = their_mil_tech_level
							value = trigger_value:mil_tech
							who = PREV
						}
						export_to_variable = {
							which = our_total_tech_level
							value = 0
						}
						export_to_variable = {
							which = their_total_tech_level
							value = 0
						}
						variable_arithmetic_trigger = {
							change_variable = { which = our_total_tech_level which = our_adm_tech_level }
						}
						variable_arithmetic_trigger = {
							change_variable = { which = our_total_tech_level which = our_dip_tech_level }
						}
						variable_arithmetic_trigger = {
							change_variable = { which = our_total_tech_level which = our_mil_tech_level }
						}
						variable_arithmetic_trigger = {
							change_variable = { which = their_total_tech_level which = their_adm_tech_level }
						}
						variable_arithmetic_trigger = {
							change_variable = { which = their_total_tech_level which = their_dip_tech_level }
						}
						variable_arithmetic_trigger = {
							change_variable = { which = their_total_tech_level which = their_mil_tech_level }
						}
						variable_arithmetic_trigger = {
							change_variable = { which = their_total_tech_level value = -9 }
						}
						
						check_variable = { which = their_total_tech_level which = our_total_tech_level }
					}
				}
			}
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = { is_at_war = no }
		capital_scope = { trade_range = FROM }
	}
	on_accept = {
		FROM = {
			create_subject = {
				subject = ROOT
				subject_type = protectorate
			}
		}
		if = {
			limit = {
				any_country = {
					is_subject_of = ROOT
					is_colonial_nation = no
				}
			}
			every_country = {
				limit = {
					is_subject_of = ROOT
					is_colonial_nation = no
				}
				ROOT = {
					PREV = { grant_independence = yes }
				}
			}
		}
	}
	on_decline = {
		FROM = {
			add_country_modifier = {
				name = declined_become_protectorate
				duration = 1825
				hidden = yes
			}
		}
		add_opinion = {
			who = FROM
			modifier = declined_ask_to_become_protectorate
		}
	}
	ai_acceptance = {
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					NOT = { has_opinion = { who = ROOT value = 0 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					NOT = { has_opinion = { who = ROOT value = 100 } }
					has_opinion = { who = ROOT value = 0 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
			export_to_variable = {
				variable_name = ai_value_2
				value = opinion
				who = FROM
				with = THIS
			}
			divide_variable = { which = ai_value_2 value = 4 }
			change_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					has_opinion = { who = ROOT value = 100 }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = THIS
			}
			divide_variable = { which = ai_value value = 8 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_domineering }
						ai_attitude = { who = ROOT attitude = attitude_protective }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10000
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_allied }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OUR_DIPLOMATIC_REPUTATION
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = THIS
			}
			multiply_variable = { which = ai_value value = -0.5 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = trigger_value:mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = trigger_value:mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = ai_value
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					variable_arithmetic_trigger = {
						change_variable = { which = our_mil_tech which = their_mil_tech }
					}
					multiply_variable = { which = our_mil_tech value = 3 }
					variable_arithmetic_trigger = {
						change_variable = { which = ai_value which = our_army_size }
					}
					variable_arithmetic_trigger =  {
						change_variable = { which = ai_value which = our_mil_tech }
					}
					
					NOT = { check_variable = { which = ai_value value = -349 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 350
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = trigger_value:mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = trigger_value:mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = ai_value
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					variable_arithmetic_trigger = {
						change_variable = { which = our_mil_tech which = their_mil_tech }
					}
					multiply_variable = { which = our_mil_tech value = 3 }
					variable_arithmetic_trigger = {
						change_variable = { which = ai_value which = our_army_size }
					}
					variable_arithmetic_trigger =  {
						change_variable = { which = ai_value which = our_mil_tech }
					}
					
					check_variable = { which = ai_value value = -349 }
					NOT = { check_variable = { which = ai_value value = 60 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = trigger_value:mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = trigger_value:mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = trigger_value:mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = trigger_value:mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = ai_value
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					variable_arithmetic_trigger = {
						change_variable = { which = our_mil_tech which = their_mil_tech }
					}
					multiply_variable = { which = our_mil_tech value = 3 }
					variable_arithmetic_trigger = {
						change_variable = { which = ai_value which = our_army_size }
					}
					variable_arithmetic_trigger =  {
						change_variable = { which = ai_value which = our_mil_tech }
					}
					
					check_variable = { which = ai_value value = 60 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = ai_value
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = ai_value which = our_total_development }
					change_variable = { which = ai_value value = -90 }
					
					check_variable = { which = ai_value value = -349 }
					NOT = { check_variable = { which = ai_value value = 60 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = ai_value
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = ai_value which = our_total_development }
					change_variable = { which = ai_value value = -90 }
					
					NOT = { check_variable = { which = ai_value value = -349 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 350
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = ai_value
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = ai_value which = our_total_development }
					change_variable = { which = ai_value value = -90 }
					
					check_variable = { which = ai_value value = 60 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
		}
	}
	ai_will_do = {
		total_development = 70
		NOT = { total_development = 200 }
		NOT = { adm_tech = FROM }
		NOT = { dip_tech = FROM }
		NOT = { mil_tech = FROM }
		NOT = {
			any_country = { is_subject_of = ROOT }
		}
		has_opinion = { who = FROM value = 50 }
		FROM = { 
			NOT = { has_country_modifier = declined_become_protectorate }
			institution_difference = { who = ROOT value = 1 }
			OR = {
				ai_attitude = { who = ROOT attitude = attitude_friendly }
				ai_attitude = { who = ROOT attitude = attitude_allied }
				ai_attitude = { who = ROOT attitude = attitude_neutral }
				ai_attitude = { who = ROOT attitude = attitude_threatened }
			}
			OR = {
				NOT = { has_casus_belli_against = ROOT }
				ROOT = {
					NOT = {
						num_of_owned_provinces_with = {
							value = 3
							OR = {
								is_claim = FROM
								is_core = FROM
								any_country = {
									is_subject_of = FROM
									PREV = { is_claim = PREV }
								}
								any_country = {
									is_subject_of = FROM
									PREV = { is_core = PREV }
								}
							}
						}
					}
				}
			}
		}
	}
}

cancel_protectorate = {
	category = influence
	
	require_acceptance = no
	
	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = protectorate
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = { is_at_war = no }
		NOT = { truce_with = FROM }
	}
	on_accept = {
		if = {
			limit = {
				NOT = { full_idea_group = diplomatic_ideas }
			}
			add_stability = -1
		}
		FROM = {
			grant_independence = yes
			country_event = { id = more_subjects_protectorate_events.2 }
			add_opinion = {
				who = ROOT
				modifier = released_protectorate
			}
		}
	}
	ai_will_do = {
		OR = {
			stability = 2
			adm_power = 300
			full_idea_group = diplomatic_ideas
		}
		OR = {
			AND = {
				FROM = {
					all_owned_province = {
						all_neighbor_province = {
							OR = {
								owned_by = FROM
								owned_by = ROOT
								owner = {
									is_subject_of = ROOT
									NOT = { liberty_desire = 50 }
								}
							}
						}
					}
				}
				has_casus_belli_against = FROM
			}
			AND = {
				FROM = { liberty_desire = 80 }
				NOT = {
					calc_true_if = {
						all_province = {
							OR = {
								owned_by = ROOT
								owner = {
									NOT = { tag = FROM }
									is_subject_of = ROOT
								}
							}
							same_continent = FROM
						}
						amount = 15
					}
				}
				OR = {
					is_year = 1800
					current_age = age_of_revolutions
				}
			}
		}
	}
}